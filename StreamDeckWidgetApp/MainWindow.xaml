<ui:FluentWindow x:Class="StreamDeckWidgetApp.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:converters="clr-namespace:StreamDeckWidgetApp.Core.Converters"
                 xmlns:behaviors="clr-namespace:StreamDeckWidgetApp.Core.Behaviors"
                 mc:Ignorable="d"
                 Title="Virtual Deck"
                 SizeToContent="WidthAndHeight"
                 ResizeMode="NoResize"
                 Topmost="True"
                 WindowCornerPreference="Round"
                 WindowBackdropType="Mica"
                 ExtendsContentIntoTitleBar="True"
                 MinHeight="100"
                 MinWidth="100">

    <ui:FluentWindow.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:ImagePathToImageSourceConverter x:Key="PathToImage"/>
    </ui:FluentWindow.Resources>

    <Grid Margin="1">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- TitleBar -->
            <RowDefinition Height="Auto"/>
            <!-- Deck Items - BURADA * YERINE Auto -->
        </Grid.RowDefinitions>

        <!-- WPF UI Title Bar: Sürükleme + Snap Layouts + Sistem Menüsü Desteği -->
        <ui:TitleBar Grid.Row="0"
                     Title="My Deck"
                     Height="32"
                     Margin="0,0,0,0"
                     ShowMaximize="False"
                     ShowMinimize="False"
                     ShowHelp="False">
            <ui:TitleBar.TrailingContent>
                <ui:Button Command="{Binding OpenEditorCommand}"
                           Icon="{ui:SymbolIcon Settings28}"
                           ToolTip="Settings"
                           Width="44"
                           Height="30"
                           Appearance="Transparent"
                           Background="Transparent"
                           BorderThickness="0"
                           Padding="0"
                           Margin="0,0,0,0">

                </ui:Button>
            </ui:TitleBar.TrailingContent>
        </ui:TitleBar>


        <!-- Butonlar (Deck Items) -->

        <ItemsControl Grid.Row="1"
                     ItemsSource="{Binding DeckItems}"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center"
                     Margin="0">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="{Binding DataContext.Columns, RelativeSource={RelativeSource AncestorType=Window}}"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Button Command="{Binding DataContext.ItemClickCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                            CommandParameter="{Binding}"
                            Margin="1"
                            Cursor="Hand"
                            BorderThickness="0"
                            Width="{Binding DataContext.SelectedButtonSize, RelativeSource={RelativeSource AncestorType=Window}}"
                            Height="{Binding DataContext.SelectedButtonSize, RelativeSource={RelativeSource AncestorType=Window}}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="MainBorder"
                                                    Background="{Binding Color}"
                                                    CornerRadius="8"
                                                    Padding="5"
                                                    AllowDrop="True"
                                                    Drop="Button_Drop"
                                                    BorderThickness="3"
                                                    RenderTransformOrigin="0.5,0.5">
                                                <Border.RenderTransform>
                                                    <ScaleTransform x:Name="ButtonScale"
                                                                    ScaleX="1"
                                                                    ScaleY="1"/>
                                                </Border.RenderTransform>
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="BorderBrush"
                                                                Value="Transparent"/>
                                                        <Style.Triggers>
                                                            <!-- Seçili buton vurgusu -->
                                                            <DataTrigger Binding="{Binding IsSelected}"
                                                                         Value="True">
                                                                <Setter Property="BorderBrush"
                                                                        Value="#4CC2FF"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <Grid x:Name="ContentGrid">
                                                    <!-- Dosya İkonu (IconPath varsa) -->
                                                    <Image Source="{Binding IconPath, Converter={StaticResource PathToImage}}"
                                                           Stretch="UniformToFill"
                                                           Opacity="0.8"/>

                                                    <!-- Segoe MDL2 / Emoji İkonu (Icon varsa) -->
                                                    <TextBlock Text="{Binding Icon}"
                                                               FontFamily="Segoe MDL2 Assets"
                                                               FontSize="32"
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"
                                                               Margin="0,0,0,0"
                                                               Opacity="0.95">

                                                    </TextBlock>
                                                </Grid>
                                            </Border>

                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Setter Property="Cursor"
                                        Value="Hand"/>
                            </Style>
                        </Button.Style>
                    </Button>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</ui:FluentWindow>
